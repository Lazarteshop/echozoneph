

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Watch & Earn PH</title>
<meta name="viewport" content="width=device-width">

<style>
body{background:#111;color:#fff;font-family:Arial}
.box{background:#1a1a1a;padding:15px;margin:10px;border-radius:8px}
.hidden{display:none}
button{padding:10px;border-radius:5px}
.progress{width:100%;height:10px;background:#333}
.progress div{height:100%;background:#0f0;width:0}
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://www.youtube.com/iframe_api"></script>
</head>
<body>

<div id="loginBox" class="box">
  <h3>Login</h3>
  <input id="username" placeholder="Username"><br>
  <input id="password" type="password" placeholder="Password"><br>
  <button onclick="login()">Login</button>
  <div id="loginMsg"></div>
</div>

<div id="userPanel" class="hidden">

<div class="box">
Balance: ₱<span id="balance">0</span>
<div class="progress"><div id="bar"></div></div>
<button id="withdrawBtn" disabled onclick="showWithdraw()">Withdraw</button>
</div>

<div class="box">
Referral:
<input id="refInput">
<button onclick="saveRef()">Save</button>
<div id="refMsg"></div>
</div>

<div class="box">
Daily Bonus: <span id="dailyBonus"></span>
</div>

<div class="box">
<div id="player"></div>
<div id="timer"></div>
<div class="progress"><div id="videoBar"></div></div>
</div>

<div class="box">
<h4>Earnings History</h4>
<div id="earningsHistory"></div>
</div>

<div class="box">
<h4>Withdrawals</h4>
<div id="withdrawHistory"></div>
</div>

</div>

<div id="withdrawBox" class="box hidden">
<button onclick="withdraw('GCash')">GCash</button>
<button onclick="withdraw('Maya')">Maya</button>
</div>

<script>
const client = supabase.createClient(
 "https://latimgzxirdlcetikufy.supabase.co",
 "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxhdGltZ3p4aXJkbGNldGlrdWZ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzODI1NDksImV4cCI6MjA4Mzk1ODU0OX0.wfrJkLAmrn895meab65kMdsRWNapPrvWiiw8cdDCNUY"
);

const VIDEO_POOL=["tUMXTD8STeU","ZspGPko6-1w","JATpLtghZCY"];
const DAILY_LIMIT=6;

let currentUser,uData={},player,videoList=[],videoIndex=0;

const today=()=>new Date().toISOString().slice(0,10);
const rand=(a,b)=>+(Math.random()*(b-a)+a).toFixed(2);

function onYouTubeIframeAPIReady(){}

async function login(){
 const {data,error}=await client.from("users")
  .select("*")
  .eq("username",username.value)
  .eq("password",password.value)
  .single();

 if(error||!data){loginMsg.textContent="Wrong login";return;}

 currentUser=data;
 loginBox.classList.add("hidden");
 userPanel.classList.remove("hidden");
 loadUserData();
}

async function loadUserData(){
 let {data}=await client.from("userdata")
  .select("*").eq("user_id",currentUser.id).single();

if(!data){
  await client.from("userdata").insert({
   user_id:currentUser.id,total:0,watchedToday:[],dailyVideos:[]
  });
  return loadUserData();
 }

 uData=data;
 dailyReset();
 dailyBonus();
 render();
 loadHistory();
 loadVideo();
}

async function saveUser(){
 await client.from("userdata").update(uData).eq("user_id",currentUser.id);
}

function dailyReset(){
 if(uData.lastDate!==today()){
  uData.lastDate=today();
  uData.watchedToday=[];
  videoIndex=0;
  videoList=[...VIDEO_POOL].sort(()=>Math.random()-0.5).slice(0,DAILY_LIMIT);
  uData.dailyVideos=videoList;
  uData.bonusVideo=videoList[Math.floor(Math.random()*videoList.length)];
  saveUser();
 }
 videoList=uData.dailyVideos;
}

async function dailyBonus(){
 if(uData.lastBonus===today()){dailyBonus.textContent="Claimed";return;}
 let b=rand(0.1,5);
 uData.total+=b;
 uData.lastBonus=today();
 await client.from("earnings").insert({user_id:currentUser.id,type:"Daily Bonus",amount:b});
 await saveUser();
 dailyBonus.textContent="₱"+b;
}

function loadVideo(){
 if(videoIndex>=videoList.length)return;
 player=new YT.Player("player",{
  videoId:videoList[videoIndex],
  playerVars:{autoplay:1,controls:0,mute:0},
  events:{onStateChange:e=>{
   if(e.data===YT.PlayerState.ENDED)reward();
  }}
 });
}

async function reward(){
 let r=(videoList[videoIndex]===uData.bonusVideo)?1.99:rand(0.1,1);
 uData.total+=r;
 uData.watchedToday.push(videoList[videoIndex]);
 await client.from("earnings").insert({user_id:currentUser.id,type:"Video",amount:r});
 videoIndex++;
 await saveUser();
 render();
 loadHistory();
 loadVideo();
}

function render(){
 balance.textContent=uData.total.toFixed(2);
 let p=Math.min(uData.total/50*100,100);
 bar.style.width=p+"%";
 withdrawBtn.disabled=uData.total<50;
}

function showWithdraw(){withdrawBox.classList.remove("hidden");}

async function withdraw(m){
 await client.from("withdrawals").insert({user_id:currentUser.id,method:m,amount:uData.total,status:"pending"});
 uData.total=0;
 await saveUser();
 render();
 loadHistory();
 withdrawBox.classList.add("hidden");
}

async function saveRef(){
 if(uData.refUser)return;
 let r=rand(0.1,8);
 uData.refUser=refInput.value;
 uData.total+=r;
 await client.from("earnings").insert({user_id:currentUser.id,type:"Referral",amount:r});
 await saveUser();
 render();
 loadHistory();
 refMsg.textContent="You earned ₱"+r;
}

async function loadHistory(){
 let {data:e}=await client.from("earnings").select("*").eq("user_id",currentUser.id).order("time",{ascending:false});
 earningsHistory.innerHTML="";
 (e||[]).forEach(x=>{
  earningsHistory.innerHTML+=`<div>${x.type} ₱${x.amount}</div>`;
 });

 let {data:w}=await client.from("withdrawals").select("*").eq("user_id",currentUser.id);
 withdrawHistory.innerHTML="";
 (w||[]).forEach(x=>{
  withdrawHistory.innerHTML+=`<div>${x.method} ₱${x.amount} ${x.status}</div>`;
 });
}
</script>
</body>
</html>