



/* USERS */
const USERS={
 user1:{pass:"dipwd1234",role:"user"},
 risadelapate:{pass:"460613",role:"user"},
 user2:{pass:"dipwdabcd",role:"user"},
 John:{pass:"101017",role:"user"},
 Delf:{pass:"230738",role:"user"},
 jonardbelleza:{pass:"251935",role:"user"},
 Regine:{pass:"230293",role:"user"},
 Benggalleon041:{pass:"beng41",role:"user"},
 jaynegalleon:{pass:"jayne1",role:"user"},
 user3:{pass:"dipwdadmin123",role:"admin"}
};

const VIDEO_POOL=[ "tUMXTD8STeU","ZspGPko6-1w","JATpLtghZCY","vJ7iZH6ILJM","jGyG5Xty37c","jP96fZG48h4","evj4fzBBiFI","HRaVepQYHRA","QtBuiOSrffQ","2mEte_9nhSs","U6yvT288bY8","r-jw-aWkbgc","Saf0QgV2dBs","oY_yCQvZ5Ko","4bJBloATeRw","MaLbebYE83E","iIiv0j5v6t8","ugz6RrkaN94","QQf0Qm-o9is","lGmpCB6-LUA","X6UvWJ3ApIw","YfE4a_qwYjQ","nLmaGOOMLr8"];
const DAILY_LIMIT=6;

let currentUser,data,player,ytReady=false;
let dailyVideos=[],videoIndex=0;
let timerInt,countdownInt;

const today=()=>{let d=new Date();return d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+String(d.getDate()).padStart(2,"0")};
const tomorrow=()=>{let d=new Date();d.setDate(d.getDate()+1);d.setHours(0,0,0,0);return d};
const rand=(a,b)=>+(Math.random()*(b-a)+a).toFixed(2);
const shuffle=a=>{for(let i=a.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a};

window.onload=()=>{
 Object.keys(USERS).forEach(u=>{
  let o=document.createElement("option");
  o.value=u;o.textContent=u;
  userSelect.appendChild(o);
 });
};

function onYouTubeIframeAPIReady(){ytReady=true}

/* LOGIN */
password.onkeypress = async e => {
 if(e.key!=="Enter")return;
 let u=userSelect.value;
 if(password.value!==USERS[u].pass){alert("Wrong password");return;}
 currentUser=u;
 login.remove();

if(USERS[u].role==="admin"){
   userPanel.classList.add("hidden");
   adminPanel.classList.remove("hidden");
   loadAdminUsers();
   return;
 }

 refBox.classList.remove("hidden");
 await loadData();
 await dailyReset();
 await claimDailyBonus();
 loadReferral();
 render();
};

/* ========== ADMIN FUNCTIONS ========== */
async function loadAdminUsers(){
 const {data:rows}=await supabaseClient.from("users").select("username,data");
 adminUserList.innerHTML="";
 rows.forEach(r=>{
  let o=document.createElement("option");
  o.value=r.username;
  o.textContent=r.username;
  o.dataset.data=JSON.stringify(r.data);
  adminUserList.appendChild(o);
 });
 adminUserList.onchange=showAdminUser;
 showAdminUser();
}

function showAdminUser(){
 let opt=adminUserList.selectedOptions[0];
 if(!opt)return;
 let d=JSON.parse(opt.dataset.data);
 adminBalance.value=d.total||0;
 adminGcash.value=d.gcash||"";
 adminWithdraws.innerHTML=(d.withdraw||[]).map(w=>`<div class="card">${w.method} ₱${w.amount}<br>${w.time}</div>`).join("");
}

async function saveAdminEdit(){
 let u=adminUserList.value;
 let opt=adminUserList.selectedOptions[0];
 let d=JSON.parse(opt.dataset.data);
 d.total=parseFloat(adminBalance.value)||0;
 d.gcash=adminGcash.value;
 await supabaseClient.from("users").update({data:d}).eq("username",u);
 alert("Saved!");
 loadAdminUsers();
}

/* ========== USER FUNCTIONS (ORIGINAL) ========== */
async function loadData(){
 const { data:row } = await supabaseClient.from("users").select("data").eq("username",currentUser).single();
 if(!row){
  data={total:0,earn:[],withdraw:[],watchedToday:[],dailyVideos:[],lastDate:null,lastBonus:null,refUser:null,refReward:0,bonusVideo:null,gcash:""};
  await supabaseClient.from("users").insert({username:currentUser,data:data});
 }else data=row.data;
}
async function save(){await supabaseClient.from("users").update({data:data}).eq("username",currentUser);}

/* (All your original referral, video, reward, render, withdraw, countdown functions stay EXACTLY as you sent — unchanged) */
/* ... paste your original user-side functions here exactly ... */

</script>
</body>
</html>