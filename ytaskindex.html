<!DOCTYPE html>
<html lang="tl">
<head>
<meta charset="UTF-8">
<title>Watch & Earn PH</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="refresh" content="350; url=https://echozoneph-viewers-watchtoearn2026.netlify.app/ytaskindex.html">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<script>
const supabaseUrl = "https://latimgzxirdlcetikufy.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxhdGltZ3p4aXJkbGNldGlrdWZ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzODI1NDksImV4cCI6MjA4Mzk1ODU0OX0.wfrJkLAmrn895meab65kMdsRWNapPrvWiiw8cdDCNUY";
const supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey);
</script>

<style>
body{margin:0;font-family:Arial;background:#0b0b0b;color:#fff}
.container{max-width:900px;margin:auto;padding:20px;text-align:center}
.box{background:#111;padding:15px;border-radius:10px;margin-bottom:15px}
.green{color:#00ff88}
.lock{color:#ff6666}
button{padding:10px 15px;border:none;border-radius:6px;cursor:pointer}
button:disabled{background:#555;cursor:not-allowed}
input,select{padding:10px;width:100%;max-width:300px;margin:5px;border-radius:6px;border:none}
.progress{width:100%;height:12px;background:#333;border-radius:10px;overflow:hidden}
.progress div{height:100%;background:#00ff88;width:0}
.hidden{display:none}

#extraGamePopup{position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:99999;display:none;align-items:center;justify-content:center}
.cardWrap{display:flex;gap:20px;justify-content:center}
.gameCard{width:120px;height:160px;background:#444;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:18px;cursor:pointer}
</style>
</head>
<body>

<div class="container">
<div class="box">
üí∞ Balance: ‚Ç±<span id="balance">0.00</span>
<div class="progress"><div id="withdrawProgress"></div></div>
<small>Minimum withdrawal ‚Ç±50</small><br>
<button id="withdrawBtn" disabled>Mag-Withdraw</button>
</div>

<h2>üé¨ Watch & Earn PH</h2>

<div id="login" class="box">
<select id="userSelect"></select><br>
<input id="password" type="password" placeholder="Ilagay ang password">
</div>

<div id="adminPanel" class="box hidden">
<h3>üõ† Admin Panel ‚Äì Extra Games</h3>
<select id="targetUser"></select><br>
<label><input type="checkbox" id="extraToggle"> Enable Extra Game Popup</label><br><br>
<input id="taskText" placeholder="Task text (editable ng admin)">
<button onclick="saveAdminSettings()">I-save</button>
<p id="adminMsg" class="green"></p>
</div>
</div>

<div id="extraGamePopup">
 <div class="box">
  <h3>üé¥ EXTRA GAMES</h3>
  <p>Entry cost: ‚Ç±10</p>
  <p>Pumili ng isang card</p>
  <div class="cardWrap">
   <div class="gameCard" onclick="pickCard(0)">‚ùì</div>
   <div class="gameCard" onclick="pickCard(1)">‚ùì</div>
  </div>
  <p id="gameResult"></p>
 </div>
</div>

<script>
const EXTRA_GAME_COST=10;
const EXTRA_GAME_REWARD=10.05;

const USERS={
user1:{pass:"dipwd1234",role:"user"},
Jeryanroyate:{pass:"101017",role:"user"},
risadelapate:{pass:"460613",role:"user"},
user2:{pass:"dipwdabcd",role:"user"},
John:{pass:"101017",role:"user"},
Christinebengil:{pass:"007608",role:"user"},
Jaycervantes:{pass:"101017",role:"user"},
CKill:{pass:"101017",role:"user"},
Jcarl:{pass:"101017",role:"user"},
Delf:{pass:"230738",role:"user"},
jonardbelleza:{pass:"251935",role:"user"},
Regine:{pass:"230293",role:"user"},
Benggalleon041:{pass:"beng41",role:"user"},
jaynegalleon:{pass:"jayne1",role:"user"},
user3:{pass:"dipwdadmin123",role:"admin"}
};

let currentUser,data;
let shuffledResult=[]; // <-- SHUFFLED RESULT

window.onload=()=>{
 Object.keys(USERS).forEach(u=>{
  userSelect.add(new Option(u,u));
  targetUser.add(new Option(u,u));
 });
};

password.onkeypress=async e=>{
 if(e.key!=="Enter")return;
 let u=userSelect.value;
 if(password.value!==USERS[u].pass){alert("Mali ang password");return;}
 currentUser=u;
 login.remove();
 if(USERS[u].role==="admin")adminPanel.classList.remove("hidden");
 await loadData();
 render();
 if(data.extraGame===true && !data.extraGameUsed){
  shuffleCards();
  extraGamePopup.style.display="flex";
 }
};

function shuffleCards(){
 // true = reward, false = task
 shuffledResult=[true,false].sort(()=>Math.random()-0.5);
}

async function loadData(){
 const {data:row}=await supabaseClient.from("users").select("data").eq("username",currentUser).single();
 if(!row){
  data={total:0,extraGame:false,extraGameUsed:false,taskText:""};
  await supabaseClient.from("users").insert({username:currentUser,data});
 }else data=row.data;
}

async function save(){await supabaseClient.from("users").update({data}).eq("username",currentUser)}

function render(){
 balance.textContent=data.total.toFixed(2);
 withdrawBtn.disabled=data.total<50;
 withdrawProgress.style.width=Math.min(data.total/50*100,100)+"%";
}

async function pickCard(index){
 if(data.total<EXTRA_GAME_COST){alert("Kulang ang balance");return;}
 data.total-=EXTRA_GAME_COST;

 if(shuffledResult[index]){
  data.total+=EXTRA_GAME_REWARD;
  gameResult.textContent="üéâ Panalo ka ‚Ç±"+EXTRA_GAME_REWARD;
 }else{
  gameResult.textContent="‚ùÑÔ∏è TASK: "+data.taskText;
 }
 data.extraGameUsed=true;
 await save();render();
 setTimeout(()=>extraGamePopup.style.display="none",15000);
}

async function saveAdminSettings(){
 let u=targetUser.value;
 const {data:row}=await supabaseClient.from("users").select("data").eq("username",u).single();
 let d=row.data;
 d.extraGame=extraToggle.checked;
 d.extraGameUsed=false;
 d.taskText=taskText.value;
 await supabaseClient.from("users").update({data:d}).eq("username",u);
 adminMsg.textContent="‚úÖ Saved";
}
</script>
</body>
</html>
