<!DOCTYPE html>
<html lang="tl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WATCH TO EARN ULTRA LEVEL 3000 FULL PRODUCTION</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
body{font-family:Arial;background:#020617;color:#fff;margin:0;text-align:center}
.box{background:#0f172a;margin:15px;padding:15px;border-radius:12px}
button,input,select{padding:10px;margin:5px;border-radius:8px;border:none}
button{background:#22c55e;color:#fff;font-weight:bold}
iframe{border-radius:12px}
.hidden{display:none}
.warn{color:#f87171;font-weight:bold}
.disabled{opacity:.4;pointer-events:none}
</style>
</head>
<body>

<h2>WATCH TO EARN â€“ ULTRA LEVEL 3000 ðŸš€</h2>

<!-- AUTH -->
<div id="authBox" class="box">
<h3>Login / Signup</h3>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<br>
<button onclick="signUp()">SIGN UP</button>
<button onclick="login()">LOGIN</button>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel" class="hidden">
<div class="box">
<h3>ðŸ‘‘ ADMIN PANEL</h3>
<input id="voucherCode" placeholder="Voucher Code">
<select id="voucherPlan">
<option value="basic">BASIC</option>
<option value="premium">PREMIUM</option>
<option value="vip">VIP</option>
</select>
<button onclick="createVoucher()">CREATE VOUCHER</button>
<p>Total Users: <span id="totalUsers">0</span></p>
</div>
</div>

<!-- RESELLER PANEL -->
<div id="resellerPanel" class="hidden">
<div class="box">
<h3>ðŸ§¾ SUB RESELLER DASHBOARD</h3>
<p>Voucher Balance: <span id="voucherBal">0</span></p>
<select id="plan">
<option value="trial">FREE TRIAL (0)</option>
<option value="basic">BASIC (-2)</option>
<option value="premium">PREMIUM (-4)</option>
<option value="vip">VIP (-6)</option>
</select>
<button onclick="createUserAccount()">CREATE ACCOUNT</button>
</div>
</div>

<!-- USER PANEL -->
<div id="userPanel" class="hidden">
<div class="box">
<h3>ðŸ‘¤ USER DASHBOARD</h3>
<p id="expireWarn" class="warn"></p>
Balance â‚±<span id="balance">0</span><br>
Watched Today <span id="watchCount">0</span>/6
</div>

<div class="box">
<button onclick="startVideo()">â–¶ START VIDEO</button><br>
<iframe id="yt" width="320" height="190" allow="autoplay"></iframe>
<p id="timer">Waiting...</p>
</div>

<div class="box">
<button onclick="withdraw()">WITHDRAW</button>
<p id="withdrawInfo"></p>
</div>

<div class="box">
<h3>ðŸ“œ EARN HISTORY</h3>
<div id="earnHistory"></div>
</div>

<div class="box">
<h3>ðŸ’¸ WITHDRAW HISTORY</h3>
<div id="withdrawHistory"></div>
</div>
</div>

<script>
// ==== PALITAN MO ==== 
const SUPABASE_URL = "https://nfusswkszrlehjsurhih.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5mdXNzd2tzenJsZWhqc3VyaGloIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2NTMwMDMsImV4cCI6MjA4NjIyOTAwM30.yz771wCi9i11ImPp52nlZm1swl3ZfUZ5DUbs6t_Xkbw";

// ====================

const sb=supabase.createClient(SUPABASE_URL,SUPABASE_KEY);
let user=null;
let role="user";
let timer=null;
let sec=20;

const videos=[
"https://www.youtube.com/embed/dQw4w9WgXcQ?enablejsapi=1",
"https://www.youtube.com/embed/ysz5S6PUM-U?enablejsapi=1",
"https://www.youtube.com/embed/tgbNymZ7vqY?enablejsapi=1"
];

// AUTO LOGIN SESSION
sb.auth.getSession().then(async r=>{
if(r.data.session){
user=r.data.session.user;
await loadRole();
}
});

async function signUp(){
const {error}=await sb.auth.signUp({
email:document.getElementById("email").value,
password:document.getElementById("password").value
});
if(error)alert(error.message);else alert("Signup success");
}

async function login(){
const {data,error}=await sb.auth.signInWithPassword({
email:document.getElementById("email").value,
password:document.getElementById("password").value
});
if(error)return alert(error.message);
user=data.user;
await loadRole();
}

async function loadRole(){
document.getElementById("authBox").style.display="none";

const {data}=await sb.from("profiles").select("*").eq("id",user.id).single();
if(!data)return;
role=data.role||"user";

if(role==="admin"){
document.getElementById("adminPanel").classList.remove("hidden");
loadAdmin();
}

if(role==="reseller"){
document.getElementById("resellerPanel").classList.remove("hidden");
document.getElementById("voucherBal").innerText=data.voucher_balance||0;
}

if(role==="user"){
document.getElementById("userPanel").classList.remove("hidden");
document.getElementById("balance").innerText=data.balance||0;
document.getElementById("watchCount").innerText=data.watch_today||0;
checkExpiry(data.expire_at);
loadHistory();
updateWithdrawInfo(data.balance||0);
}
}

// ADMIN CREATE VOUCHER
async function createVoucher(){
const code=document.getElementById("voucherCode").value;
const plan=document.getElementById("voucherPlan").value;
await sb.from("vouchers").insert({code,plan});
alert("Voucher Created");
}

async function loadAdmin(){
const {count}=await sb.from("profiles").select("*",{count:"exact",head:true});
document.getElementById("totalUsers").innerText=count||0;
}

// RESELLER CREATE USER (ULTRA 3000 BACKEND READY)
async function createUserAccount(){
alert("Use Supabase Edge Function for secure account creation + voucher deduction");
}

// VIDEO WATCH SYSTEM
function randVideo(){return videos[Math.floor(Math.random()*videos.length)]}

async function startVideo(){
const {data}=await sb.from("profiles").select("watch_today").eq("id",user.id).single();
if(data.watch_today>=6){alert("Daily limit reached");return}

const src=randVideo()+"&autoplay=1&mute=1";
document.getElementById("yt").src=src;
sec=20;
clearInterval(timer);

timer=setInterval(async()=>{
sec--;
document.getElementById("timer").innerText="Watching "+sec;
if(sec<=0){
clearInterval(timer);
await reward();
document.getElementById("timer").innerText="Reward Granted";
}
},1000);
}

async function reward(){
await sb.rpc("add_reward",{uid:user.id,amount:(Math.random()*0.9+0.1).toFixed(2)});
location.reload();
}

// WITHDRAWAL 3 STAGE SYSTEM
function updateWithdrawInfo(balance){
let text="";
if(balance>=200) text="Stage 3: Cash Withdrawal Activated";
else if(balance>=150) text="Stage 2: Redeem Crabpaste Required";
else if(balance>=50) text="Stage 1: â‚±50 Cash Available";
else text="Minimum â‚±50 to withdraw";
document.getElementById("withdrawInfo").innerText=text;
}

async function withdraw(){
const {data}=await sb.from("profiles").select("balance").eq("id",user.id).single();
let bal=data.balance||0;

if(bal>=200){
await sb.from("withdrawals").insert({uid:user.id,amount:bal});
alert("Cash Withdrawal Requested");
}
else if(bal>=150){
alert("Redeem Crabpaste Product First");
}
else if(bal>=50){
await sb.from("withdrawals").insert({uid:user.id,amount:50});
alert("â‚±50 Cash Requested");
}else{
alert("Not enough balance");
}
}

// ACCOUNT EXPIRY
function checkExpiry(exp){
if(!exp)return;
const now=new Date();
const ex=new Date(exp);
if(now>ex){
document.getElementById("expireWarn").innerText="ACCOUNT EXPIRED";
document.getElementById("userPanel").classList.add("disabled");
}
}

// HISTORY LOAD
async function loadHistory(){
const earn=await sb.from("earnings").select("amount,created_at").eq("uid",user.id).limit(10);
const wd=await sb.from("withdrawals").select("amount,created_at").eq("uid",user.id).limit(10);

let ehtml="";
earn.data?.forEach(x=>ehtml+=`â‚±${x.amount} - ${x.created_at}<br>`);
document.getElementById("earnHistory").innerHTML=ehtml;

let whtml="";
wd.data?.forEach(x=>whtml+=`â‚±${x.amount} - ${x.created_at}<br>`);
document.getElementById("withdrawHistory").innerHTML=whtml;
}
</script>
</body>
</html>
