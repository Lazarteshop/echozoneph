

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Watch & Earn PH</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

<script>
const supabaseUrl = "https://latimgzxirdlcetikufy.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxhdGltZ3p4aXJkbGNldGlrdWZ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzODI1NDksImV4cCI6MjA4Mzk1ODU0OX0.wfrJkLAmrn895meab65kMdsRWNapPrvWiiw8cdDCNUY";
const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
</script>


<style>
body {margin:0; background:#0b0b0b; color:#fff; font-family:Arial;}
.container {max-width:900px; margin:auto; padding:15px; text-align:center;}
.box {background:#111; padding:15px; border-radius:10px; margin-bottom:12px;}
button {padding:10px 15px; border:none; border-radius:6px; cursor:pointer;}
button:disabled {background:#555; cursor:not-allowed;}
.hidden {display:none;}
.progress {width:100%; height:12px; background:#333; border-radius:10px; overflow:hidden;}
.progress div {height:100%; background:#00ff88; width:0;}
.lock {color:#ff6666; margin-bottom:10px;}
.green {color:#00ff88;}
input, select {padding:8px; border-radius:6px; border:none; margin:5px 0; width:80%;}
</style>
</head>

<body>
<div class="container">

<div id="userPanel">
  <div id="lockMsg" class="lock"></div>

  <div class="box">
    üí∞ Balance ‚Ç±<span id="balance">0.00</span>
    <div class="progress"><div id="withdrawProgress"></div></div>
    <button id="withdrawBtn" disabled>Withdraw</button>
  </div>

  <div id="login" class="box">
    <select id="userSelect"></select>
    <input id="password" type="password" placeholder="Password">
  </div>

<div id="refBox" class="box hidden">
    <input id="refUsername" placeholder="Referrer username">
    <button id="saveRef">Save Referrer</button>
    <div id="refMsg" class="green"></div>
  </div>

  <div class="box">
    <button class="earnBtn" onclick="watchVideo()">Watch Video</button>
    <button class="earnBtn" onclick="claimReward()">Claim Reward</button>
  </div>
</div>

<div id="adminPanel" class="hidden">
  <h2>üõ† Admin Panel</h2>
  <div class="box">
    <select id="adminUserList"></select>
    <input id="adminBalance" type="number" step="0.01" placeholder="Balance">
    <input id="adminGcash" placeholder="GCash">
    <button onclick="saveAdminEdit()">Save</button>
    <br><br>
    <button onclick="setFreeze(true)">‚ùÑ Freeze</button>
    <button onclick="setFreeze(false)">‚úÖ Unfreeze</button>
  </div>
</div>

<script>
const USERS = {
  user1:{pass:"dipwd1234",role:"user"},
  Jeryanroyate:{pass:"101017",role:"user"},
  risadelapate:{pass:"460613",role:"user"},
  user2:{pass:"dipwdabcd",role:"user"},
  John:{pass:"101017",role:"user"},
  Christinebengil:{pass:"007608",role:"user"},
  Jaycervantes:{pass:"101017",role:"user"},
  CKill:{pass:"101017",role:"user"},
  Jcarl:{pass:"101017",role:"user"},
  Delf:{pass:"230738",role:"user"},
  jonardbelleza:{pass:"251935",role:"user"},
  Regine:{pass:"230293",role:"user"},
  Benggalleon041:{pass:"beng41",role:"user"},
  jaynegalleon:{pass:"jayne1",role:"user"},
  user3:{pass:"dipwdadmin123",role:"admin"}
};

let currentUser, data;

window.onload = () => {
  Object.keys(USERS).forEach(u => {
    let o = document.createElement("option");
    o.value = u; o.textContent = u;
    userSelect.appendChild(o);
  });
};

password.onkeypress = async e => {
  if(e.key !== "Enter") return;
  let u = userSelect.value;
  if(password.value !== USERS[u].pass){ alert("Wrong password"); return; }
  currentUser = u;
  login.remove();

if(USERS[u].role === "admin"){
    userPanel.classList.add("hidden");
    adminPanel.classList.remove("hidden");
    loadAdminUsers();
    return;
  }

  await loadData();
  updateLockMsg();
  refBox.classList.remove("hidden");
  render();
};

async function loadData(){
  const {data:row} = await supabaseClient
    .from("users")
    .select("data")
    .eq("username",currentUser)
    .single();

  if(!row){
    data = {
total:0,
      earn:[],
      withdraw:[],
      gcash:"",
      accountStatus:"active",
      inviteUnlockCount:0,
      abuseScore:0
    };
    await supabaseClient.from("users").insert({username:currentUser,data});
  }else{
    data = row.data;
    data.accountStatus = data.accountStatus || "active";
    data.inviteUnlockCount = data.inviteUnlockCount || 0;
    data.abuseScore = data.abuseScore || 0;
  }
}


async function save(){
  await supabaseClient.from("users").update({data}).eq("username",currentUser);
}

function render(){
  balance.textContent = data.total.toFixed(2);
  withdrawBtn.disabled = data.total < 50 || data.accountStatus === "frozen";

  document.querySelectorAll('.earnBtn').forEach(b => {
    b.disabled = data.accountStatus === "frozen";
  });

withdrawProgress.style.width = Math.min(data.total / 50 * 100, 100) + "%";
  updateLockMsg();
}

function updateLockMsg(){
  if(data.accountStatus === "frozen"){
    lockMsg.textContent = `üßä Your account is frozen. Invite ${2 - (data.inviteUnlockCount || 0)} people to unlock.`;
  } else {
    lockMsg.textContent = "";
  }
}

function watchVideo() {
  if(data.accountStatus === "frozen"){ updateLockMsg(); return; }
  data.total += 1; // example earning
  render();
  save();
}

function claimReward() {
  if(data.accountStatus === "frozen"){ updateLockMsg(); return; }
  data.total += 5; // example reward
  render();
  save();
}

saveRef.onclick = async () => {
  if(data.refUser) return;
  let ref = refUsername.value.trim();
  if(!ref || ref === currentUser) return;

  const {data:refRow} = await supabaseClient
    .from("users")
    .select("data")
    .eq("username",ref)
    .single();

  if(!refRow){
    refMsg.textContent = "‚ùå Invalid referrer";
    return;
  }

data.refUser = ref;
  refRow.data.inviteUnlockCount = (refRow.data.inviteUnlockCount || 0) + 1;

  if(refRow.data.inviteUnlockCount >= 2){
    refRow.data.accountStatus = "active";
    if(currentUser === refRow.username) updateLockMsg();
  }

  await supabaseClient.from("users").update({data:refRow.data}).eq("username",ref);
  await save();
  refMsg.textContent = "‚úÖ Referral verified";
};


async function loadAdminUsers(){
  const {data:rows} = await supabaseClient.from("users").select("username,data");
  adminUserList.innerHTML = "";
  rows.forEach(r => {
    let o = document.createElement("option");
    o.value = r.username;
    o.textContent = r.username;
    o.dataset.data = JSON.stringify(r.data);
    adminUserList.appendChild(o);
  });
  adminUserList.onchange = showAdminUser;
  showAdminUser();
}

function showAdminUser(){
  let opt = adminUserList.selectedOptions[0];
  if(!opt) return;
  let d = JSON.parse(opt.dataset.data);
  adminBalance.value = d.total || 0;
  adminGcash.value = d.gcash || "";
}

async function saveAdminEdit(){
  let u = adminUserList.value;
  let opt = adminUserList.selectedOptions[0];
  let d = JSON.parse(opt.dataset.data);
  d.total = parseFloat(adminBalance.value) || 0;
  d.gcash = adminGcash.value;
  await supabaseClient.from("users").update({data:d}).eq("username",u);
  alert("Saved");
  loadAdminUsers();
}

async function setFreeze(state){
  let u = adminUserList.value;
  let opt = adminUserList.selectedOptions[0];
  let d = JSON.parse(opt.dataset.data);
  d.accountStatus = state ? "frozen" : "active";
  if(!state) d.inviteUnlockCount = 0;
  await supabaseClient.from("users").update({data:d}).eq("username",u);
  alert(state ? "‚ùÑ Account Frozen" : "‚úÖ Account Unfrozen");
  loadAdminUsers();
  if(currentUser === u) render();
}
</script>
</body>
</html>