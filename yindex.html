


/* LOGIN */
password.addEventListener("keypress",e=>{
 if(e.key==="Enter"){
  const u=userSelect.value;
  if(password.value===USERS[u].password){
   currentUser=u;
   loadUserData();
   login.remove();
   updateBalance();
   renderHistory();
   loadVideo();
  }else alert("Wrong password");
 }
});

/* USER DATA */
function loadUserData(){
 USERS[currentUser].data=
 JSON.parse(localStorage.getItem("earn_"+currentUser))||
 {total:0,watched:[],history:[]};
}
function saveUserData(){
 localStorage.setItem("earn_"+currentUser,JSON.stringify(USERS[currentUser].data));
}
/* RANDOM + JACKPOT */
function getReward(){
 if(Math.random()<0.1) return 1.0; // JACKPOT
 return parseFloat((Math.random()*(0.5-0.1)+0.1).toFixed(1));
}

/* LOAD VIDEO */
function loadVideo(){
 if(currentVideo>=videos.length){
  earned.textContent="‚úÖ All videos completed";
  return;
 }
const vid=videos[currentVideo];
 if(USERS[currentUser].data.watched.includes(vid.id)){
  currentVideo++; loadVideo(); return;
 }
 playerArea.innerHTML="<div id='player'></div>";
 player=new YT.Player("player",{
  videoId:vid.id,
  playerVars:{autoplay:1,controls:0},
  events:{
   onReady:startTimer,
   onStateChange:e=>{
    if(e.data===YT.PlayerState.ENDED) rewardUser();
   }
  }
 });
}

/* TIMER + PROGRESS */
function startTimer(){
 let wait=setInterval(()=>{
  let d=Math.floor(player.getDuration());
  if(d>0){clearInterval(wait);runTimer(d);}
 },200);
}
function runTimer(total){
 let t=total;
 clearInterval(timerInterval);
 timerInterval=setInterval(()=>{
  let m=Math.floor(t/60),s=t%60;
  timer.textContent=`‚è±Ô∏è ${m}:${s.toString().padStart(2,"0")}`;
  progressBar.style.width=((total-t)/total*100)+"%";
  t--; if(t<0)clearInterval(timerInterval);
 },1000);
}
/* REWARD */
function rewardUser(){
 const r=getReward();
 const d=USERS[currentUser].data;
 d.total+=r;
 d.watched.push(videos[currentVideo].id);
 d.history.push({title:videos[currentVideo].title,amount:r,time:new Date().toLocaleString()});
 saveUserData();
 earnSound.play();
 earned.innerHTML=`üéâ You earned ‚Ç±${r}${r===1?" (JACKPOT!)":""}`;
 updateBalance();
 renderHistory();
 currentVideo++;
 setTimeout(loadVideo,3000);
}
/* BALANCE + WITHDRAW LIMIT */
function updateBalance(){
 const total=USERS[currentUser].data.total;
 balance.textContent=total.toFixed(2);
 withdrawBtn.disabled = total < 50;
 balanceBox.classList.remove("bump");void balanceBox.offsetWidth;
 balanceBox.classList.add("bump");
}
/* HISTORY */
function renderHistory(){
 historyList.innerHTML="";
 USERS[currentUser].data.history.forEach(h=>{
  let d=document.createElement("div");
  d.className="card";
  d.innerHTML=`<b>${h.title}</b><br>‚Ç±${h.amount} ‚Äî ${h.time}`;
  historyList.appendChild(d);
 });
}
/* WITHDRAW */
withdrawBtn.onclick=()=>{
 const total=USERS[currentUser].data.total;
 if(total<50){
  alert("Minimum withdrawal is ‚Ç±50");
  return;
 }
 alert("Withdraw SUCCESS (DEMO)\nAmount: ‚Ç±"+total.toFixed(2));
 USERS[currentUser].data.total=0;
 saveUserData();
 updateBalance();
 renderHistory();
};

/* BASIC ANTI INSPECT */
document.addEventListener("keydown",e=>{
 if(e.key==="F12"||(e.ctrlKey&&e.shiftKey))e.preventDefault();
});
</script>
</body>
</html>